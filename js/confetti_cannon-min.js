"use strict";function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function getLength(t,e,i,n){var s=i-t,r=n-e;return Math.sqrt(s*s+r*r)}function getDegAngle(t,e,i,n){var s=n-e,r=i-t;return Math.atan2(s,r)*(180/Math.PI)}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),DECAY=4,SPREAD=60,GRAVITY=1200,ConfettiCannon=function(){function t(){_classCallCheck(this,t),this.canvas=document.getElementById("canvas"),this.dpr=window.devicePixelRatio||1,this.ctx=this.canvas.getContext("2d"),this.ctx.scale(this.dpr,this.dpr),this.confettiSpriteIds=[],this.confettiSprites={},this.drawVector=!1,this.vector=[{x:window.innerWidth,y:1.25*window.innerHeight},{x:window.innerWidth,y:2*window.innerHeight}],this.pointer={},this.render=this.render.bind(this),this.handleMousedown=this.handleMousedown.bind(this),this.handleMouseup=this.handleMouseup.bind(this),this.handleMousemove=this.handleMousemove.bind(this),this.handleTouchstart=this.handleTouchstart.bind(this),this.handleTouchmove=this.handleTouchmove.bind(this),this.setCanvasSize=this.setCanvasSize.bind(this),this.setupListeners(),this.setCanvasSize()}return _createClass(t,[{key:"setupListeners",value:function t(){TweenLite.ticker.addEventListener("tick",this.render)}},{key:"setCanvasSize",value:function t(){this.canvas.width=window.innerWidth*this.dpr,this.canvas.height=window.innerHeight*this.dpr,this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px"}},{key:"handleMousedown",value:function t(e){clearTimeout(this.timer);var i=e.clientX*this.dpr,n=e.clientY*this.dpr;this.vector[0]={x:i,y:n},this.drawVector=!0}},{key:"handleTouchstart",value:function t(e){clearTimeout(this.timer),e.preventDefault();var i=e.touches[0].clientX*this.dpr,n=e.touches[0].clientY*this.dpr;this.vector[0]={x:i,y:n},this.drawVector=!0}},{key:"handleMouseup",value:function t(e){this.drawVector=!1;var i=this.vector[0].x,n=this.vector[0].y,s=this.vector[1].x,r=this.vector[1].y,h=getLength(i,n,s,r),a=getDegAngle(i,n,s,r)+180,o=h/5+5,c=10*h;this.addConfettiParticles(o,a,c,i,n)}},{key:"handleMousemove",value:function t(e){var i=e.clientX*this.dpr,n=e.clientY*this.dpr;this.vector[1]={x:i,y:n},this.pointer=this.vector[1]}},{key:"handleTouchmove",value:function t(e){e.preventDefault();var i=e.changedTouches[0].clientX*this.dpr,n=e.changedTouches[0].clientY*this.dpr;this.vector[1]={x:i,y:n},this.pointer=this.vector[1]}},{key:"drawVectorLine",value:function t(){this.ctx.strokeStyle="pink",this.ctx.lineWidth=2*this.dpr;var e=this.vector[0].x,i=this.vector[0].y,n=this.vector[1].x,s=this.vector[1].y;this.ctx.beginPath(),this.ctx.moveTo(e,i),this.ctx.lineTo(n,s),this.ctx.stroke()}},{key:"addConfettiParticles",value:function t(e,i,n,s,r){for(var h=0;h<e;){var a=_.random(4,6)*this.dpr,o=_.random(15,25)*this.dpr,c=_.random(30,255),l=_.random(30,230),d=_.random(30,230),u="rgb("+c+", "+l+", "+d+")",v=_.random(10,-10),f=_.random(.07,.05),p=0,y=_.uniqueId(),x=_defineProperty({},y,{angle:i,velocity:n,x:s,y:r,r:a,d:o,color:u,tilt:v,tiltAngleIncremental:f,tiltAngle:0});Object.assign(this.confettiSprites,x),this.confettiSpriteIds.push(y),this.tweenConfettiParticle(y),h++}}},{key:"tweenConfettiParticle",value:function t(e){var i=this,n=this.confettiSprites[e].angle-SPREAD/2,s=this.confettiSprites[e].angle+SPREAD/2,r=this.confettiSprites[e].velocity/4,h=this.confettiSprites[e].velocity,a=_.random(r,h),o=_.random(n,s),c=GRAVITY,l=_.random(.1,.25),d=0;TweenLite.to(this.confettiSprites[e],DECAY,{physics2D:{velocity:a,angle:o,gravity:c,friction:l},d:0,ease:Power4.easeIn,onComplete:function t(){_.pull(i.confettiSpriteIds,e),delete i.confettiSprites[e]}})}},{key:"updateConfettiParticle",value:function t(e){var i=this.confettiSprites[e],n=5e-4*i.d;i.angle+=.01,i.tiltAngle+=n,i.tiltAngle+=i.tiltAngleIncremental,i.tilt=Math.sin(i.tiltAngle-i.r/2)*i.r*2,i.y+=2*Math.sin(i.angle+i.r/2),i.x+=Math.cos(i.angle)/2}},{key:"drawConfetti",value:function t(){var e=this;this.confettiSpriteIds.map(function(t){var i=e.confettiSprites[t];e.ctx.beginPath(),e.ctx.lineWidth=i.d/2,e.ctx.strokeStyle=i.color,e.ctx.moveTo(i.x+i.tilt+i.r,i.y),e.ctx.lineTo(i.x+i.tilt,i.y+i.tilt+i.r),e.ctx.stroke(),e.updateConfettiParticle(t)})}},{key:"drawPointer",value:function t(){var e=this.pointer.x,i=this.pointer.y,n=15*this.dpr;this.ctx.beginPath(),this.ctx.arc(e,i,n,0,2*Math.PI,!1),this.ctx.fillStyle="transparent",this.ctx.fill(),this.ctx.lineWidth=2*this.dpr,this.ctx.strokeStyle="#ffffff",this.ctx.stroke()}},{key:"drawPower",value:function t(){var e=this.vector[0].x,i=this.vector[0].y,n=this.vector[1].x,s=this.vector[1].y,r=getLength(e,i,n,s),h=e,a=i,o=1*this.dpr*r/20;this.ctx.beginPath(),this.ctx.arc(h,a,o,0,2*Math.PI,!1),this.ctx.fillStyle="transparent",this.ctx.fill(),this.ctx.lineWidth=2*this.dpr,this.ctx.strokeStyle="#333333",this.ctx.stroke()}},{key:"render",value:function t(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawVector&&this.drawVectorLine(),this.drawVector&&this.drawPower(),this.drawPointer(),this.drawConfetti()}}]),t}();